<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title><%= &title || 'RplusMgmt' %></title>
    <!--meta name="viewport" content="width=device-width, initial-scale=1.0"-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Rplus Management">
    <meta name="author" content="Alexander Orlenko">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="<%= $assets_url %>/bootstrap/<%= $bootstrap_ver %>/css/bootstrap.min.css">
    <!-- Pines Notify -->
    <link rel="stylesheet" href="<%= $assets_url %>/pnotify/1.2.2/jquery.pnotify.default.css">

    <style type="text/css">
      body {
        padding-top: 70px;
        padding-bottom: 50px;
      }

      .margin-bottom-10 {
        margin-bottom: 10px;
      }

      .margin-bottom-15 {
        margin-bottom: 15px;
      }

      .margin-bottom-20 {
        margin-bottom: 20px;
      }

      textarea {
        max-width: 100%;
      }

      .list-group.list-compact > .list-group-item {
        padding-top: 5px ;
        padding-bottom: 5px;
        border-left: 0;
        border-right: 0;
        border-radius: 0;
      }

      .list-group.list-compact > .list-group-item:first-of-type {
        border-top: 0;
      }

      .list-group.list-compact > .list-group-item:last-of-type {
        border-bottom: 0;
      }

      .well-md {
        padding: 15px;
        margin-bottom: 15px;
      }

      .panel-md {
        margin-bottom: 15px;
      }

      .panel-sm {
        margin-bottom: 15px;
      }

      .panel-sm .panel-body {
        padding: 9px;
      }

      .form-group-sm {
        margin-bottom: 10px;
      }

      .nav-sm > li > a {
        padding: 8px 12px;
      }

      .hr-sm {
        margin-top: 10px;
        margin-bottom: 10px;
      }

      % if ($self->req->headers->user_agent =~ /Windows/) {
        ::-webkit-scrollbar {
          width: 5px;
        }

        ::-webkit-scrollbar-track {
          margin: 2px;
          /* set the style/colour of the scroll bar background */
          background:
          -webkit-gradient(
            linear,
            0 0,
            100% 0,
            from(rgba(0,0,0,0.2)),
            to(rgba(0,0,0,0.12))
          );
          -webkit-box-shadow: 0 1px 0 0 rgba(255,255,255,0.35);
          -webkit-border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
          /* this is the acutal scrooll bar, set the colours here to match your site */
          /* I have used grey's (#464646 & #383838 & #cccccc) */
          background: rgba(0,0,0,.5);
          -webkit-border-radius: 6px;
          -webkit-background-clip: padding-box;
        }
      % }

      .animation-rotate {
        -webkit-animation: spin 2s infinite linear;
                animation: spin 2s infinite linear;
      }

      @-webkit-keyframes spin {
        0% {
          -webkit-transform: rotate(0deg);
        }
        100% {
          -webkit-transform: rotate(359deg);
        }
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(359deg);
        }
      }

      .geo-map {
        cursor: default !important;
      }

      .geo-map:active {
        cursor: -webkit-grab !important;
      }

      .disable-on-ajax.disabled {
        /*opacity: 0.5;*/
        pointer-events: none;
      }

      .ui-pnotify.stack-bottomright {
        /* These are just CSS default values to reset the pnotify CSS. */
        right: auto;
        top: auto;
      }
    </style>

    <%= content_for 'header' %>
  </head>
  <body>

    <!-- Navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-top-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a href="/" class="navbar-brand">RplusMgmt</a>
        </div>

        <div class="collapse navbar-collapse navbar-top-collapse">
          <ul class="nav navbar-nav">
          % if (has_permission(realty => 'read') && !is_hidden_nav('search')) {
            <li class="<%= $controller eq 'search' && 'active' %>"><a href="/search"><span class="glyphicon glyphicon-search"></span> <%= ucfloc q{search} %></a></li>
          % }
          % if (has_permission(realty => 'read') && !is_hidden_nav('realty')) {
            <li class="<%= $controller eq 'realty' && 'active' %>"><a href="/realty"><span class="glyphicon glyphicon-home"></span> <%= ucfloc q{realty} %></a></li>
          % }
          % if (has_permission(realty => 'export')) {
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-star"></span> <%= ucfloc q{services} %> <b class="caret"></b></a>
              <ul class="dropdown-menu">
              % if (has_permission(realty => 'export')) {
                <li><a href="/service/export"><span class="glyphicon glyphicon-export"></span> <%= ucfloc q{export media} %></a></li>
              % }
              </ul>
            </li>
          % }
          % if (has_permission(subscriptions => 'read')) {
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-stats"></span> <%= ucfloc q{analytics} %> <b class="caret"></b></a>
              <ul class="dropdown-menu">
              % if (has_permission(subscriptions => 'read')) {
                <li><a href="/analytics/subscriptions"><span class="glyphicon glyphicon-list-alt"></span> <%= ucfloc q{subscriptions} %></a></li>
              % }
              </ul>
            </li>
          % }
          % if (
          %  has_permission(mediators => 'read') || has_permission(landmarks => 'read') || has_permission(users => 'manage')
          % ) {
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-cog"></span> <%= ucfloc q{configuration} %> <b class="caret"></b></a>
              <ul class="dropdown-menu">
              % if (has_permission(mediators => 'read')) {
                <li><a href="/configuration/mediators"><span class="glyphicon glyphicon-ban-circle"></span> <%= ucfloc q{mediators} %></a></li>
              % }
              % if (has_permission(landmarks => 'read')) {
                <li><a href="/configuration/landmarks"><span class="glyphicon glyphicon-globe"></span> <%= ucfloc q{landmarks} %></a></li>
              % }
              % if (has_permission(users => 'manage')) {
                <li><a href="/configuration/users"><span class="glyphicon glyphicon-user"></span> <%= ucfloc q{users} %></a></li>
              % }
              </ul>
            </li>
          % }
          </ul>
          <p class="navbar-text navbar-right visible-lg">
            <%= ucfloc q{signed in as} %> [<a href="/signout" class="navbar-link"><%= $user->{'name'} %></a>]
          </p>
        </div>
      </div>
    </nav>

    <div class="container disable-on-ajax">
      <%= content %>

      <!-- Modal Definitions -->
      <%= content_for 'modals' %>
    </div>

    <!-- JavaScript -->
    <script type="application/javascript" src="<%= $assets_url %>/jquery/<%= $jquery_ver %>/jquery-<%= $jquery_ver %>.min.js"></script>
    <%= content_for 'before_bootstrap' %>
    <!-- Bootstrap -->
    <script type="application/javascript" src="<%= $assets_url %>/bootstrap/<%= $bootstrap_ver %>/js/bootstrap.min.js"></script>
    <!-- MomentJS -->
    <script type="application/javascript" src="<%= $assets_url %>/moment/<%= $momentjs_ver %>/moment.min.js"></script>
    <!-- HolderJS -->
    <script type="application/javascript" src="<%= $assets_url %>/holder/<%= $holderjs_ver %>/holder.min.js"></script>
    <!-- Pines Notify -->
    <script type="application/javascript" src="<%= $assets_url %>/pnotify/1.2.2/jquery.pnotify.js"></script>
    <%= content_for 'after_bootstrap' %>

    <%= include 'javascript/rplus' %>

    <script type="application/javascript">
      "use strict";

      var globalAjaxEventsRegistered = 0;
      function registerGlobalAjaxEvents() {
        if (globalAjaxEventsRegistered) return;
        $(document)
          .ajaxStart(function () {
            $('.disable-on-ajax').addClass('disabled'); $('.indicator-ajax').removeClass('invisible');
          })
          .ajaxStop(function () {
            $('.disable-on-ajax').removeClass('disabled'); $('.indicator-ajax').addClass('invisible');
          })
        ;
        globalAjaxEventsRegistered = 1;
      }
    </script>
    <%= content_for 'javascript' %>

    <script type="application/javascript">
      "use strict";
      $(function () {
        $(document).on('click', 'a[href="#"]', function (event) { event.preventDefault(); });
      });
    </script>
  </body>
</html>
